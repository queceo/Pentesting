#!/usr/bin/env python
import database 
import time
import subprocess

class scanner:
	def __init__(self):

		#all the tasks we have to excecute fo the scan
		self._taskList = []

		#database initialization
		self.DB = database.DataBase("data.db")
		self.DB.connect()

	def ping(self):
		scanIpList = self.DB.get_scan_ip()
		for row in scanIpList:
			print "Pinging: %s on %s" % (row[1],row[2]) 
			subprocess.call(["ping",row[1],"-p",row[2],"-c","1"])

		#Add an ip to scanlist
	def add_scan_ip(self,iip, iport): 
		format_str = """INSERT INTO scanlist (id, ip, port, added)
	    VALUES (NULL, "{ip}", "{port}", "{added}")"""
		sql_command = format_str.format(ip=iip, port=iport, added=time.strftime("%d/%m/%Y"))
		self.DB.sql_exec(sql_command)
		self.DB.connection.commit()
		print "IP Adress: %s port: %s added on %s" % (iip,iport,time.strftime("%d/%m/%Y"))

	#returns list with all ip's to scan
	def get_scan_ip(self):
		sql_command = """SELECT * FROM scanlist;"""
		self.DB.sql_exec(sql_command)
		return list(self.DB.cursor.fetchall())


	def delete_scan_ip(self,iid):
		format_str = """DELETE FROM scanlist WHERE id="{id}";"""
		sql_command = format_str.format(id=iid)
		self.DB.sql_exec(sql_command)
		return list(self.DB.cursor.fetchall())

