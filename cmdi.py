#!/usr/bin/env python

import cmd
import scanner
import os

class CMD(cmd.Cmd):
	"""Simple command processor example."""
	
	def __init__(self):
		cmd.Cmd.__init__(self)
		self.prompt = "> "
		self.intro  = "Welcome to console!"  ## defaults to None
		#print "########################################################################################################################################################"
                #print "#                                                                                                                                                      #"
                #print "#    ,ad8888ba,                                                               88    ,ad8888ba,  888888888888                                           #"
                #print "#   d8"'    `"8b                                                              88   d8"'    `"8b      88                                                #"
                #print "#  d8'        `8b                                                             88  d8'                88                                                #"
                #print "#  88          88  8b,dPPYba,  88,dPYba,,adPYba,    ,adPPYba,  8b,dPPYba,     88  88                 88                                                #"
                #print "#  88          88  88P'   \"Y8  88P\'   \"88\"    \"8a  a8P_____88  88P\'   \"Y8     88  88                 88                                                #"
                #print "#  Y8,        ,8P  88          88      88      88  8PP""""""\"  88             88  Y8,                88                                                #"
                #print "#   Y8a.    .a8P   88          88      88      88  "8b,   ,aa  88             88   Y8a.    .a8P      88                                                #"
                #print "#    `"Y8888Y"'    88          88      88      88   `"Ybbd8"'  88             88    `"Y8888Y"'       88                                                #"
                #print "#                                                                                                                                                      #"
                #print "#                                                                                                                                                      #"
                #print "#                                                                                                                                                      #"
                #print "#  88888888ba                                                                  88                               888888888888                       88  #"
                #print "#  88      "8b                           ,d                             ,d     ""                                    88                            88  #"
                #print "#  88      ,8P                           88                             88                                           88                            88  #"
                #print "#  88aaaaaa8P'  ,adPPYba,  8b,dPPYba,  MM88MMM  ,adPPYba,  ,adPPYba,  MM88MMM  88  8b,dPPYba,    ,adPPYb,d8          88   ,adPPYba,    ,adPPYba,   88  #"
                #print "#  88""""""'   a8P_____88  88P'   `"8a   88    a8P_____88  I8[    ""    88     88  88P'   `"8a  a8"    `Y88          88  a8"     "8a  a8"     "8a  88  #"
                #print "#  88          8PP"""""""  88       88   88    8PP"""""""   `"Y8ba,     88     88  88       88  8b       88          88  8b       d8  8b       d8  88  #"
                #print "#  88          "8b,   ,aa  88       88   88,   "8b,   ,aa  aa    ]8I    88,    88  88       88  "8a,   ,d88          88  "8a,   ,a8"  "8a,   ,a8"  88  #"
                #print "#  88           `"Ybbd8"'  88       88   "Y888  `"Ybbd8"'  `"YbbdP"'    "Y888  88  88       88   `"YbbdP"Y8          88   `"YbbdP"'    `"YbbdP"'   88  #"
                #print "#                                                                                                aa,    ,88                                            #"
                #print "#                                                                                                "Y8bbdP"                                              #"
                #print "#  By: Job, Rico, Quinten & Lars - From: The Hage University                                                                                           #"
                #print "########################################################################################################################################################"
                #print "########################################################################################################################################################"

		#scanner Object
		self.SC = scanner.scanner()


	#scanner actions
	def do_scanner(self, arguments):
		args = arguments.split()
		if len(args) >= 1:

			# add ip with port to database scanlist
			# usage: scanner add [ip] [port]
			if args[0] == "add":
				try: 
					ipaddress = args[1]
					port      = args[2]
					self.SC.add_scan_ip(ipaddress,port) 
				except:
					print "Usage: scanner add [ip] [port]"
			
			# delete ip with port from database scanlist
			# usage: scanner delete [id]
			elif args[0] == "delete":
				try: 
					iid = args[1]
					self.SC.delete_scan_ip(iid) 
				except:
					print "Usage: scanner delete [id]"

			# starts the scan 
			# usage: scanner start
			elif args[0] == "start":
				self.SC.startQueue()

			elif args[0] == "addtask":
                                task = [];
                                for x in args:
                                        task.append(x);
                                task.remove("addtask");
                                self.SC.addTask(task);
                                
                        elif args[0] == "tasklist":
                                tasklist = self.SC.getTaskList();
                                for x in tasklist:
                                        print  "ID: ", x[0], "Task: ", x[1];
                                        
                        elif args[0] == "deltask":
                                self.SC.delTask(args[1]);
                                tasklist = self.SC.getTaskList();
                                for x in tasklist:
                                        print  "ID: ", x[0], "Task: ", x[1];

                        elif args[0] == "TaskDirectory":
                                dirs = os.listdir(args[1]);
                                for files in dirs:
                                        self.SC.addTaskStr(files);
                                

		else:
			print "Usage: scanner add [ip] [port]"


	#show [smt] commands
	def do_show(self, arguments):
		"""show [smt] to look up """

		args = arguments.split()
		if len(args) >= 1:
			
			#show scanlist
			if (args[0] == "scanlist"):
				print "DATABASE scanlist:"
				scanIpList = self.SC.get_scan_ip()
				for row in scanIpList:
					print "ID: ",row[0]," | ip-address: ", row[1], " | port: ",row[2], " | Date: ", row[3]  
			
			#show Help
			elif (args[0] == "?"):
				print "Possible actions:"
				print "scanlist: show all ips/ports to scan"
			
			#show nothing
			else: 
				print "Nothing to show for %s" % args[0]    
		#no arguments
		else:
			print "Nothing to show"

	def do_EOF(self, line):
		"""EOF Exit cmd"""
		return True
